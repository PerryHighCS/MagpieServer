<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Magpie Chat</title>
        <link rel="stylesheet" href="style.css">
        <link rel="shortcut icon" type="image/x-icon" href="/img/magpie.png">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="UTF-8">
    </head>
    <body>
        <div id="chat">
            <div class="chatmsg">
                <img src="/img/magpie.png" alt="Magpie said: ">Let's chat.
            </div>
        </div>

        <footer>
            <form id="userInput" onsubmit="chat(event)">
                <input type="text" id="msg" placeholder="Type your message here..."> <button type="submit" id="send">Send</button>
            </form>
            <a href="https://www.flaticon.com/free-icons/magpie" title="magpie icons"><img src="/img/magpie.png" alt="Magpie"> Magpie icons created by Ylivdesign - Flaticon</a>
            &nbsp;
            <a href="https://www.flaticon.com/free-icons/user" title="user icons"><img src="/img/user.png" alt="User"> User icons created by Freepik - Flaticon</a>
        </footer>

        <script lang="javascript">
function chat(e) {
    e.preventDefault();

    const chat = document.getElementById('chat');
    const msgBox = document.getElementById('msg');

    const msg = msgBox.value;
    msgBox.value = '';
    
    const userBubble = chatBubble(msg, '/img/user.png', "You said: ")
    chat.appendChild(userBubble);
    userBubble.scrollIntoView({behavior: 'smooth'});
    
    fetch('/chat', {
        method: 'POST',
        headers: {
            'Content-Type': 'plain/text'
        },
        body: msg
    })
    .then(response => response.text())
    .then(response => {
        const magpieBubble = chatBubble(response, '/img/magpie.png', "Magpie said: ");
        chat.appendChild(magpieBubble);
        magpieBubble.scrollIntoView({behavior: 'smooth'});
    });

    return false;
}

function chatBubble(msg, img, alt) {
    const bubble = document.createElement('div');
    bubble.className = 'chatmsg';
    bubble.innerHTML = '<img src="' + img + '" alt="' + alt + '">';
    bubble.appendChild(document.createTextNode(msg));

    return bubble;
}
        </script>
    </body>
</html>